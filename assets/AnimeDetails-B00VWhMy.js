import{u as w,d as N,j as e,a as T,L as z}from"./index-CPSkf6_A.js";import{r as u,f as q,L as k}from"./vendor-CzuZ2vSz.js";import{L as C}from"./Layout-B3H3bNmt.js";import{u as V}from"./useQuery-BXgg03Nu.js";import{u as U}from"./usePageTitle-XJJnLCUf.js";import{u as M}from"./useAnimeLibrary-thLaFgu-.js";import{v as S,w as B,x as H,y as J,l as O,k as G,z as K,t as Q}from"./firebase-sbJdvLJZ.js";import{k as W,M as X,l as Y,m as A,i as Z,S as _,H as v,n as ee,F as se,o as re,d as te,I as ae,p as oe,q as le,r as ie,U as ne,P as E}from"./ui-DGQG60Ii.js";async function ce(t){await new Promise(c=>setTimeout(c,300));const[s,l,i]=await Promise.all([fetch(`https://api.jikan.moe/v4/anime/${t}/full`),fetch(`https://api.jikan.moe/v4/anime/${t}/characters`),fetch(`https://api.jikan.moe/v4/anime/${t}/recommendations`)]);if(!s.ok)throw new Error("Falha ao carregar anime");const x=await s.json(),n=await l.json(),p=await i.json(),r=x.data;return{anime:{id:r.mal_id,title:r.title_english||r.title,title_jp:r.title_japanese,image:r.images?.webp?.large_image_url||r.images?.jpg?.large_image_url||r.images?.jpg?.image_url,banner:r.trailer?.images?.maximum_image_url||r.images?.webp?.large_image_url||r.images?.jpg?.large_image_url,trailer:r.trailer?.embed_url,synopsis:r.synopsis,year:r.year||r.aired?.prop?.from?.year||"?",score:r.score,episodes:r.episodes||"?",duration:r.duration||"24 min",rating:r.rating,status:r.status,studios:r.studios,genres:r.genres,themes:r.themes,demographics:r.demographics,rank:r.rank,season:r.season,source:r.source,type:r.type,members:r.members,aired:r.aired},characters:n.data||[],recommendations:p.data||[]}}function de(t){const{data:s,isLoading:l,error:i}=V({queryKey:["anime",t],queryFn:()=>ce(t),staleTime:36e5,enabled:!!t,retry:1});return{anime:s?.anime||null,characters:s?.characters||[],recommendations:s?.recommendations||[],loading:l,error:i}}function me(t){const{user:s}=w(),[l,i]=u.useState([]),[x,n]=u.useState(!0);return u.useEffect(()=>{if(!t){n(!1);return}const d=S(N,"comments"),c=B(d,H("animeId","==",t)),m=J(c,g=>{const b=g.docs.map(a=>({id:a.id,...a.data()}));b.sort((a,h)=>{const j=a.createdAt?.toDate?a.createdAt.toDate():new Date(a.createdAt||0);return(h.createdAt?.toDate?h.createdAt.toDate():new Date(h.createdAt||0))-j}),i(b),n(!1)},g=>{console.error("Erro ao buscar comentários:",g),n(!1)});return()=>m()},[t]),{comments:l,loading:x,addComment:async d=>{if(!s)throw new Error("Você precisa estar logado para comentar.");if(!d.trim())throw new Error("O comentário não pode estar vazio.");if(!t)throw new Error("ID do anime inválido.");try{await K(S(N,"comments"),{animeId:parseInt(t),userId:s.uid,userName:s.name||s.displayName||"Usuário",userAvatar:s.photoURL,content:d.trim(),createdAt:Q(),likes:0})}catch(c){throw console.error("Erro ao enviar comentário:",c),c}},deleteComment:async d=>{if(s)try{const c=O(N,"comments",d);await G(c)}catch(c){throw console.error("Erro ao deletar comentário:",c),c}}}}function xe({comment:t,onDelete:s}){const{user:l}=w(),i=l&&l.uid===t.userId,x=n=>{if(!n)return"Agora";const p=n.toDate?n.toDate():new Date(n);return new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"}).format(p)};return e.jsxs("div",{className:"flex gap-4 p-4 rounded-xl bg-bg-primary/50 border border-border-color hover:border-border-color/80 transition-colors group",children:[e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:t.userAvatar||`https://ui-avatars.com/api/?name=${t.userName}&background=random`,alt:t.userName,className:"w-10 h-10 rounded-full object-cover border border-border-color"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-text-primary text-sm",children:t.userName}),e.jsx("span",{className:"text-xs text-text-secondary",children:x(t.createdAt)})]}),i&&e.jsx("button",{onClick:()=>s(t.id),className:"text-text-secondary hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-1 rounded-md hover:bg-red-500/10",title:"Deletar comentário",children:e.jsx(W,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-text-secondary text-sm leading-relaxed break-words whitespace-pre-wrap",children:t.content})]})]})}function pe({animeId:t}){const{user:s}=w(),{toast:l}=T(),{comments:i,loading:x,addComment:n,deleteComment:p}=me(t),[r,d]=u.useState(""),[c,m]=u.useState(!1),g=async a=>{if(a.preventDefault(),!!r.trim()){m(!0);try{await n(r),d(""),l.success("Comentário enviado!")}catch(h){l.error(h.message)}finally{m(!1)}}},b=async a=>{if(window.confirm("Tem certeza que deseja deletar este comentário?"))try{await p(a),l.success("Comentário removido.")}catch{l.error("Erro ao remover comentário.")}};return e.jsxs("section",{className:"mt-12",children:[e.jsxs("h2",{className:"text-2xl font-bold text-text-primary mb-6 flex items-center gap-2",children:[e.jsx(X,{className:"w-6 h-6 text-primary"}),"Comentários (",i.length,")"]}),e.jsx("div",{className:"mb-8",children:s?e.jsxs("form",{onSubmit:g,className:"relative",children:[e.jsx("textarea",{value:r,onChange:a=>d(a.target.value),placeholder:"Deixe seu comentário sobre este anime...",className:"w-full bg-bg-secondary border border-border-color rounded-xl p-4 pr-14 text-text-primary placeholder:text-text-secondary focus:ring-2 focus:ring-primary focus:border-transparent outline-none resize-none min-h-[100px] transition-all",disabled:c}),e.jsx("button",{type:"submit",disabled:!r.trim()||c,className:"absolute bottom-4 right-4 p-2 bg-primary hover:bg-primary-hover text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg",children:e.jsx(Y,{className:"w-5 h-5"})})]}):e.jsx("div",{className:"bg-bg-secondary/50 border border-border-color rounded-xl p-6 text-center",children:e.jsx("p",{className:"text-text-secondary",children:"Você precisa estar logado para comentar."})})}),x?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"space-y-4",children:i.length>0?i.map(a=>e.jsx(xe,{comment:a,onDelete:b},a.id)):e.jsx("p",{className:"text-text-secondary text-center py-8 italic",children:"Seja o primeiro a comentar!"})})]})}function Ne(){const{id:t}=q(),{anime:s,characters:l,recommendations:i,loading:x}=de(t),{user:n}=w(),{toast:p}=T(),{library:r,addToLibrary:d,incrementProgress:c,updateProgress:m,updateRating:g,toggleFavorite:b}=M();U(s?.title||"Detalhes");const a=r.find(o=>o.id.toString()===t),[h,j]=u.useState("plan_to_watch");u.useEffect(()=>{a&&j(a.status)},[a]);const[D,I]=u.useState(!1);u.useEffect(()=>{const o=setTimeout(()=>I(!0),100);return()=>clearTimeout(o)},[]);const L=o=>{j(o),n?d(s,o):p.warning("Faça login para salvar animes na sua lista!")},P=()=>{n&&a?c(a.id,a.currentEp,a.totalEp):n&&s&&d(s,"watching")},F=a?.currentEp||0,R=s?.episodes||0;if(x)return e.jsx(C,{children:e.jsx("div",{className:"flex h-[80vh] items-center justify-center",children:e.jsx(z,{})})});if(!s)return e.jsx(C,{children:e.jsx("div",{className:"flex bg-bg-primary text-text-primary items-center justify-center h-screen",children:e.jsx("p",{children:"Anime não encontrado."})})});const $=s.banner||s.image;return e.jsx(C,{children:e.jsxs("div",{className:"min-h-screen bg-bg-primary text-text-primary font-sans selection:bg-primary selection:text-white pb-20",children:[e.jsxs("section",{className:"relative w-full min-h-[50vh] lg:h-[65vh] flex items-end",children:[e.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center blur-sm scale-105",style:{backgroundImage:`url('${$}')`}}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-bg-primary via-bg-primary/80 to-transparent z-10"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-bg-primary via-bg-primary/50 to-transparent z-10"})]}),e.jsx("div",{className:"relative z-20 w-full max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 pb-8 lg:pb-16",children:e.jsxs("div",{className:`grid lg:grid-cols-12 gap-8 items-end transition-all duration-700 ${D?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[e.jsx("div",{className:"lg:col-span-3 xl:col-span-2 order-2 lg:order-1 flex justify-center lg:block mb-6 lg:mb-0",children:e.jsx("div",{className:"w-48 sm:w-64 lg:w-full aspect-[2/3] rounded-2xl overflow-hidden shadow-2xl border-4 border-bg-secondary relative group",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"lg:col-span-6 xl:col-span-7 flex flex-col gap-4 order-1 lg:order-2 mb-6 lg:mb-0 text-center lg:text-left items-center lg:items-start pt-6 lg:pt-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-center lg:justify-start gap-2",children:[e.jsx("span",{className:"px-3 py-1 rounded-lg bg-primary text-white text-xs font-bold uppercase tracking-wider shadow-lg shadow-primary/20",children:s.type||"TV"}),e.jsx("span",{className:"px-3 py-1 rounded-lg bg-white/5 backdrop-blur-md border border-white/10 text-xs font-bold uppercase tracking-wider",children:s.year||"Unknown"}),s.status&&e.jsx("span",{className:A("px-3 py-1 rounded-lg text-xs font-bold uppercase tracking-wider border backdrop-blur-md",s.status==="Finished Airing"?"bg-emerald-500/10 text-emerald-300 border-emerald-500/20":"bg-blue-500/10 text-blue-300 border-blue-500/20"),children:s.status==="Finished Airing"?"Completo":"Em Lançamento"})]}),e.jsx("h1",{className:"text-3xl md:text-5xl lg:text-6xl font-black leading-tight tracking-tight text-white drop-shadow-2xl",children:s.title}),s.title_english&&e.jsx("h2",{className:"text-lg md:text-xl text-gray-300 font-medium",children:s.title_english}),e.jsx("p",{className:"text-gray-300 text-sm md:text-base leading-relaxed max-w-3xl line-clamp-3 md:line-clamp-4",children:s.synopsis})]}),e.jsx("div",{className:"lg:col-span-3 flex flex-col justify-end order-3 lg:order-3 w-full",children:e.jsx(ue,{anime:s,libraryEntry:a,status:h,handleStatusChange:L,handleIncrement:P,updateProgress:m,updateRating:g,toggleFavorite:b,currentEp:F,totalEp:R})})]})})]}),e.jsx("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-10 py-8 lg:py-12",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-10",children:[e.jsxs("div",{className:"lg:col-span-9 xl:col-span-9 space-y-12 order-2 lg:order-1",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(y,{value:`#${s.rank||"-"}`,label:"Ranking",icon:Z}),e.jsx(y,{value:s.score||"-",label:"Score",icon:_,color:"text-yellow-500"}),e.jsx(y,{value:s.popularity||"-",label:"Popularidade",icon:v,color:"text-red-500"}),e.jsx(y,{value:s.favorites||"-",label:"Favoritos",icon:ee,color:"text-blue-500"})]}),s.trailer&&e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-primary"})," Trailer"]}),e.jsx("div",{className:"aspect-video w-full rounded-2xl overflow-hidden bg-black shadow-lg",children:e.jsx("iframe",{src:s.trailer.replace("autoplay=1","autoplay=0"),title:"Trailer",className:"w-full h-full",allowFullScreen:!0})})]}),e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary"})," Episódios"]})}),e.jsxs("div",{className:"space-y-2",children:[[1,2,3].map(o=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-bg-secondary hover:bg-bg-tertiary border border-border-color transition-colors cursor-pointer group",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"size-10 rounded-lg bg-bg-tertiary flex items-center justify-center text-text-secondary font-bold group-hover:text-primary group-hover:bg-primary/10 transition-colors",children:o}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-text-primary",children:["Episódio ",o]}),e.jsx("span",{className:"text-xs text-text-secondary",children:"Simulação de Data"})]})]}),e.jsx(te,{className:"w-6 h-6 text-text-secondary group-hover:text-primary transition-colors"})]},o)),e.jsx("button",{className:"w-full py-3 text-sm font-bold text-primary hover:bg-primary/5 rounded-xl border border-dashed border-primary/30 transition-colors",children:"Ver todos os episódios"})]})]}),e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-primary"})," Recomendações"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4",children:i?.slice(0,5).map(o=>e.jsxs(k,{to:`/anime/${o.entry.mal_id}`,className:"group relative aspect-[2/3] rounded-xl overflow-hidden bg-bg-secondary",onClick:()=>window.scrollTo(0,0),children:[e.jsx("img",{src:o.entry.images?.jpg?.image_url,alt:"",className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end p-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"text-xs font-bold text-white line-clamp-2",children:o.entry.title})})]},o.entry.mal_id))})]}),e.jsx("div",{className:"pt-8 border-t border-border-color",children:e.jsx(pe,{animeId:s.id})})]}),e.jsxs("aside",{className:"lg:col-span-3 xl:col-span-3 space-y-8 lg:sticky lg:top-24 h-fit order-1 lg:order-2",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2 border-b border-border-color pb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-primary"})," Informações"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{icon:oe,label:"Episódios",value:`${s.episodes||"?"}`}),e.jsx(f,{icon:le,label:"Duração",value:s.duration?.split("per")[0]}),e.jsx(f,{icon:ie,label:"Estúdio",value:s.studios?.[0]?.name,highlight:!0}),e.jsx(f,{icon:_,label:"Nota Média",value:s.score,color:"text-yellow-400"}),e.jsx(f,{icon:ne,label:"Membros",value:s.members?.toLocaleString()})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg border-b border-border-color pb-2",children:"Gêneros"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.genres?.map(o=>e.jsx("span",{className:"px-3 py-1.5 rounded-lg bg-bg-secondary hover:bg-bg-tertiary border border-border-color text-xs font-medium transition-colors cursor-pointer",children:o.name},o.mal_id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg border-b border-border-color pb-2",children:"Elenco"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:l?.slice(0,4).map(o=>e.jsxs(k,{to:`/character/${o.character.mal_id}`,className:"flex items-center gap-3 p-2 rounded-xl hover:bg-bg-secondary transition-colors group",children:[e.jsx("div",{className:"size-10 rounded-full overflow-hidden bg-bg-secondary",children:e.jsx("img",{src:o.character.images?.jpg?.image_url,alt:"",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold group-hover:text-primary transition-colors line-clamp-1",children:o.character.name}),e.jsx("span",{className:"text-xs text-text-secondary",children:o.role})]})]},o.character.mal_id))}),e.jsx(k,{to:"/characters",className:"block text-center text-sm font-bold text-primary hover:underline",children:"Ver todo o elenco"})]})]})]})})]})})}function ue({anime:t,libraryEntry:s,status:l,handleStatusChange:i,handleIncrement:x,updateProgress:n,toggleFavorite:p,currentEp:r,totalEp:d,updateRating:c}){return s?e.jsxs("div",{className:"bg-bg-secondary/90 backdrop-blur-xl p-5 rounded-2xl border border-white/10 shadow-xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-white",children:"Editar Progresso"}),e.jsx("button",{onClick:()=>p(t),className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(v,{className:`w-5 h-5 ${s.isFavorite?"fill-red-500 text-red-500":"text-gray-400"}`})})]}),e.jsxs("select",{value:l,onChange:m=>i(m.target.value),className:"w-full bg-bg-tertiary/50 border border-white/10 rounded-xl px-3 py-2 text-sm text-white focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"watching",children:"Assistindo"}),e.jsx("option",{value:"completed",children:"Completo"}),e.jsx("option",{value:"plan_to_watch",children:"Planejo Assistir"}),e.jsx("option",{value:"dropped",children:"Dropado"}),e.jsx("option",{value:"paused",children:"Pausado"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-black/20 p-2 rounded-xl border border-white/5",children:[e.jsx("input",{type:"number",value:r,onChange:m=>n(s.id,parseInt(m.target.value)||0,d),className:"w-12 bg-transparent text-center font-bold text-white outline-none"}),e.jsxs("span",{className:"text-gray-400",children:["/ ",d||"?"]}),e.jsx("button",{onClick:x,className:"ml-auto p-1.5 bg-primary rounded-lg text-white hover:bg-primary-hover",children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex justify-center gap-1 pt-2",children:[1,2,3,4,5].map(m=>e.jsx(_,{className:`w-5 h-5 cursor-pointer transition-transform hover:scale-110 ${(s.score||0)>=m*2?"fill-yellow-400 text-yellow-400":"text-gray-600"}`,onClick:()=>c(t.id,m*2)},m))})]}):e.jsxs("div",{className:"bg-bg-secondary/90 backdrop-blur-xl p-6 rounded-2xl border border-white/10 shadow-xl space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-white",children:"Acompanhar"}),e.jsx("button",{onClick:()=>p(t),className:"p-2 hover:bg-white/10 rounded-full transition-colors group",title:"Favoritar",children:e.jsx(v,{className:"w-5 h-5 text-gray-400 group-hover:text-red-500 transition-colors"})})]}),e.jsx("p",{className:"text-sm text-gray-300",children:"Adicione à sua lista para rastrear."}),e.jsxs("button",{onClick:()=>i("watching"),className:"w-full py-3 px-4 bg-primary hover:bg-primary-hover text-white font-bold rounded-xl shadow-lg shadow-primary/20 transition-transform active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"})," Adicionar à Lista"]})]})}function f({icon:t,label:s,value:l,color:i,highlight:x}){return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[e.jsx(t,{className:"w-4 h-4"}),e.jsx("span",{children:s})]}),e.jsx("span",{className:A("font-medium truncate max-w-[50%]",i,x&&"text-primary font-bold"),children:l||"-"})]})}function y({label:t,value:s,icon:l,color:i}){return e.jsxs("div",{className:"bg-bg-secondary p-4 rounded-xl border border-border-color flex flex-col items-center justify-center gap-1",children:[e.jsx(l,{className:A("w-6 h-6 mb-1",i||"text-text-secondary")}),e.jsx("span",{className:"font-bold text-lg text-text-primary",children:s}),e.jsx("span",{className:"text-[10px] uppercase font-bold text-text-secondary tracking-wider",children:t})]})}export{Ne as AnimeDetails};
