import{c as h,a as S,r as d,y as L,z as i,A as R,B as v,D,E as c,F as l,G as n,H as _}from"./index-DXXiX4L9.js";const k=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],F=h("clock",k);function P(){const{user:a}=S(),[g,y]=d.useState([]),[b,u]=d.useState(!0);d.useEffect(()=>{if(!a){y([]),u(!1);return}const t=L(i,"users",a.uid,"library"),e=R(t),r=v(e,s=>{const o=s.docs.map(f=>({id:parseInt(f.id),...f.data()}));y(o),u(!1)},s=>{console.error("Erro ao buscar biblioteca:",s),u(!1)});return()=>r()},[a]);const p=async(t,e="plan_to_watch")=>{if(a)try{const r=t.id||t.mal_id;if(!r){console.error("ID do anime invÃ¡lido:",t);return}const s=c(i,"users",a.uid,"library",r.toString()),o={id:r,title:t.title,image:t.images?.jpg?.image_url||t.image,totalEp:t.episodes||0,currentEp:0,status:e,score:0,lastUpdated:n()};await _(s,o,{merge:!0})}catch(r){throw console.error("Erro ao adicionar anime:",r),r}},m=async(t,e,r)=>{if(a){e<0&&(e=0),r>0&&e>r&&(e=r);try{const s=c(i,"users",a.uid,"library",t.toString()),o={currentEp:e,lastUpdated:n()};r>0&&e===r?o.status="completed":r>0&&e<r,await l(s,o)}catch(s){console.error("Erro ao atualizar progresso:",s)}}};return{library:g,loading:b,addToLibrary:p,incrementProgress:(t,e,r)=>m(t,e+1,r),updateProgress:m,updateStatus:async(t,e,r=0)=>{if(a)try{const s=c(i,"users",a.uid,"library",t.toString()),o={status:e,lastUpdated:n()};e==="completed"&&r>0&&(o.currentEp=r),await l(s,o)}catch(s){console.error("Erro ao atualizar status:",s)}},updateRating:async(t,e)=>{if(a)try{const r=c(i,"users",a.uid,"library",t.toString());await l(r,{score:e,lastUpdated:n()})}catch(r){console.error("Erro ao atualizar nota:",r)}},removeFromLibrary:async t=>{if(a)try{await D(c(i,"users",a.uid,"library",t.toString()))}catch(e){console.error("Erro ao remover anime:",e)}}}}export{F as C,P as u};
