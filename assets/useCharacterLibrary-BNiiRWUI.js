import{r as c}from"./vendor-CzuZ2vSz.js";import{u as m,d as f}from"./index-CPSkf6_A.js";import{v as g,w as p,y as v,l as h,k as w,t as b,q as y}from"./firebase-sbJdvLJZ.js";function L(){const{user:o}=m(),[t,u]=c.useState([]),[l,s]=c.useState(!0);return c.useEffect(()=>{if(!o){u([]),s(!1);return}const a=g(f,"users",o.uid,"favorite_characters"),e=p(a),i=v(e,r=>{const n=r.docs.map(d=>({id:parseInt(d.id),...d.data()}));u(n),s(!1)},r=>{console.error("Erro ao buscar favoritos de personagens:",r),s(!1)});return()=>i()},[o]),{characterLibrary:t,loading:l,toggleCharacterFavorite:async a=>{if(!o)throw console.warn("Usuário não autenticado tentar favoritar"),new Error("Faça login para favoritar.");const e=a.mal_id||a.id;if(!e)throw new Error("ID do personagem inválido");const i=t.some(r=>r.id===e);try{const r=h(f,"users",o.uid,"favorite_characters",e.toString());if(i)await w(r);else{if(t.length>=6)throw new Error("Você já possui 6 personagens favoritos. Remova um para adicionar outro.");const n={id:e,name:a.name,image:a.images?.jpg?.image_url||a.image,addedAt:b()};await y(r,n)}}catch(r){throw console.error("Erro ao alterar favorito de personagem:",r),r}},isCharacterFavorite:a=>a?t.some(e=>String(e.id)===String(a)):!1}}export{L as u};
