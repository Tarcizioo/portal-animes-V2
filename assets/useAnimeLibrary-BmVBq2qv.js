import{c as g,u as S,r as f,b as _,d as i,q as k,o as L,e as n,J as c,f as M,s as d,K as R}from"./index-DVHdDxV9.js";const I=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],q=g("plus",I);const x=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],A=g("trophy",x);function H(){const{user:s}=S(),[l,h]=f.useState([]),[v,y]=f.useState(!0);f.useEffect(()=>{if(!s){h([]),y(!1);return}const t=_(i,"users",s.uid,"library"),a=k(t),r=L(a,o=>{const e=o.docs.map(u=>({id:parseInt(u.id),...u.data()}));h(e),y(!1)},o=>{console.error("Erro ao buscar biblioteca:",o),y(!1)});return()=>r()},[s]);const m=async(t,a="plan_to_watch")=>{if(s)try{const r=t.id||t.mal_id;if(!r){console.error("ID do anime inválido:",t);return}const o=n(i,"users",s.uid,"library",r.toString()),e={id:r,title:t.title,image:t.images?.jpg?.image_url||t.image,totalEp:t.episodes||0,currentEp:0,status:a,score:0,lastUpdated:d()};await R(o,e,{merge:!0})}catch(r){throw console.error("Erro ao adicionar anime:",r),r}},p=async(t,a,r)=>{if(s){a<0&&(a=0),r>0&&a>r&&(a=r);try{const o=n(i,"users",s.uid,"library",t.toString()),e={currentEp:a,lastUpdated:d()};r>0&&a===r?e.status="completed":r>0&&a<r,await c(o,e)}catch(o){console.error("Erro ao atualizar progresso:",o)}}},w=(t,a,r)=>p(t,a+1,r),F=async(t,a,r=0)=>{if(s)try{const o=n(i,"users",s.uid,"library",t.toString()),e={status:a,lastUpdated:d()};a==="completed"&&r>0&&(e.currentEp=r),await c(o,e)}catch(o){console.error("Erro ao atualizar status:",o)}},b=async(t,a)=>{if(s)try{const r=n(i,"users",s.uid,"library",t.toString());await c(r,{score:a,lastUpdated:d()})}catch(r){console.error("Erro ao atualizar nota:",r)}};return{library:l,loading:v,addToLibrary:m,incrementProgress:w,updateProgress:p,updateStatus:F,updateRating:b,updateRating:b,removeFromLibrary:async t=>{if(s)try{await M(n(i,"users",s.uid,"library",t.toString()))}catch(a){console.error("Erro ao remover anime:",a)}},toggleFavorite:async t=>{if(!s)throw new Error("Usuário não autenticado");const a=t.id||t.mal_id,r=l.find(e=>e.id===a),o=r?.isFavorite;if(!o&&l.filter(u=>u.isFavorite).length>=3)throw new Error("Você já possui 3 favoritos. Remova um para adicionar outro.");try{const e=n(i,"users",s.uid,"library",a.toString());r?await c(e,{isFavorite:!o}):(await m(t),await c(e,{isFavorite:!0}))}catch(e){throw console.error("Erro ao alterar favorito:",e),e}}}}export{q as P,A as T,H as u};
